%{
/**************************************
*    Mateus Luiz Salvi - 00229787     *
*             INF - UFRGS             *
***************************************
****** Amusing * the * amazing ********
**************************************/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "hashtable.h"

int yyerror(char *s);
extern int getLineNumber(void);
extern int yylex();

%}

%token KW_INT
%token KW_REAL
%token KW_CHAR
%token KW_BOOL
%token KW_IF
%token KW_THEN
%token KW_ELSE
%token KW_LOOP
%token KW_INPUT
%token KW_OUTPUT
%token KW_RETURN
%token OPERATOR_LE
%token OPERATOR_GE
%token OPERATOR_EQ
%token OPERATOR_DIF
%token TK_IDENTIFIER
%token LIT_INT
%token LIT_REAL
%token LIT_CHAR
%token LIT_STRING
%token TOKEN_ERROR

%left '<' '>' OPERATOR_LE OPERATOR_GE OPERATOR_EQ OPERATOR_DIF
%left '&' '|' '~'
%left '+' '-'
%left '*' '/'

%start program

%%

program: declaration program
       |

declaration: type TK_IDENTIFIER '=' literal ';'
           | type TK_IDENTIFIER '(' parameters ')' '{' block '}'
           | vectorDeclaration ';'
           |
           ;

type: KW_INT
    | KW_REAL
    | KW_CHAR
    | KW_BOOL

vectorDeclaration: KW_INT TK_IDENTIFIER '[' LIT_INT ']' vectorInicialization
                 | KW_REAL TK_IDENTIFIER '[' LIT_INT ']' vectorInicialization
                 | KW_CHAR TK_IDENTIFIER '[' LIT_INT ']' vectorInicialization

vectorInicialization: literal vectorInicialization
                    |

literal: LIT_INT
       | LIT_REAL
       | LIT_CHAR
       | LIT_STRING

block: '{' '}'
     | '{' commandList '}'

parameters: 
          | type TK_IDENTIFIER ',' parameters
          | type TK_IDENTIFIER

command: atribuition
       | flow
       | KW_RETURN expression
       | KW_OUTPUT expression
       | KW_OUTPUT LIT_STRING
       | ';'
       | block
       | TK_IDENTIFIER OPERATOR_EQ expression
       | TK_IDENTIFIER '[' expression ']' OPERATOR_EQ expression

atribuition: TK_IDENTIFIER '[' LIT_INT ']' '=' literal
           | TK_IDENTIFIER '=' literal


commandList: command ';' commandList
           | command ';'
           | %empty

functionCall: TK_IDENTIFIER '(' expressionList ')'

expressionList: expression ',' expressionList
              | expression

flow: KW_IF '(' expression ')' command
    | KW_IF '(' expression ')' command KW_ELSE
    | KW_IF '(' expression ')' KW_LOOP command

expression: expression operator expression
          | '('expression')'
          | functionCall
          | KW_INPUT '(' type ')'

operator: '+'
        | '-'
        | '/'
        | '*'
        | '>'
        | '<'
        | '&'
        | '|'
        | '~'
        | OPERATOR_DIF
        | OPERATOR_EQ
        | OPERATOR_GE
        | OPERATOR_LE
        

%%

int yyerror(char *error)
{
     fprintf(stderr, "Syntax error at line %d", getLineNumber());
     exit(3); //Syntax error.
}